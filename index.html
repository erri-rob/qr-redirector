<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Redirecting…</title>
    <meta http-equiv="refresh" content="5; url=https://www.rainews.it/tgr/piemonte/video/2023/03/tgr-piemonte-web-moricone-satelliti-militari-pl-sicral-centro-interforze-ucraina-1cc6d906-e8ff-4459-b243-82501d24c32f.html" />
    <script>
      (function () {
        var TARGET_URL = "https://www.rainews.it/tgr/piemonte/video/2023/03/tgr-piemonte-web-moricone-satelliti-militari-pl-sicral-centro-interforze-ucraina-1cc6d906-e8ff-4459-b243-82501d24c32f.html";
        var COUNT_NAMESPACE = "qr-redirector"; // Cambia se vuoi isolare i contatori
        var COUNT_KEY = "scansioni-pagina";   // Chiave contatore
        var MIN_REDIRECT_DELAY_MS = 150;       // attesa minima per dare tempo al logging
        var MAX_LOG_WAIT_MS = 700;             // attesa massima prima di forzare il redirect

        function delay(ms) {
          return new Promise(function (resolve) {
            setTimeout(resolve, ms);
          });
        }

        function safeLocalStorageGet(key) {
          try {
            return window.localStorage.getItem(key);
          } catch (_) {
            return null;
          }
        }

        function withCacheBuster(url) {
          return url + (url.indexOf("?") === -1 ? "?" : "&") + "_=" + Date.now();
        }

        function firePixel(url) {
          return new Promise(function (resolve) {
            try {
              var img = new Image();
              img.onload = img.onerror = function () { resolve(); };
              img.src = withCacheBuster(url);
              setTimeout(resolve, 400);
            } catch (e) {
              resolve();
            }
          });
        }

        function fetchHit(url) {
          if (typeof fetch !== "function") {
            return Promise.reject(new Error("fetch unavailable"));
          }
          try {
            return fetch(withCacheBuster(url), {
              method: "GET",
              mode: "no-cors",
              cache: "no-store",
              keepalive: true,
            });
          } catch (err) {
            return Promise.reject(err);
          }
        }

        function logScan() {
          return new Promise(function (resolve) {
            var resolved = false;
            function finish() {
              if (!resolved) {
                resolved = true;
                resolve();
              }
            }

            var workerBase = (safeLocalStorageGet('qr_worker_base') || '').replace(/\/$/, '');
            var GH_USER = (location.hostname.split('.')[0] || '').toLowerCase();
            var REPO = 'qr-redirector';

            var endpoints = workerBase
              ? [workerBase + '/hit']
              : [
                  'https://github.com/' + GH_USER + '/' + REPO + '/releases/download/qr-counter/pixel.gif',
                  'https://api.countapi.xyz/hit/' + encodeURIComponent(COUNT_NAMESPACE) + '/' + encodeURIComponent(COUNT_KEY),
                  'https://api.countapi.dev/hit/' + encodeURIComponent(COUNT_NAMESPACE) + '/' + encodeURIComponent(COUNT_KEY)
                ];

            if (!endpoints.length) {
              finish();
              return;
            }

            endpoints.forEach(function (url) {
              fetchHit(url)
                .catch(function () {
                  return firePixel(url);
                })
                .finally(finish);
            });

            setTimeout(finish, MAX_LOG_WAIT_MS);
          });
        }

        Promise.all([
          Promise.race([logScan(), delay(MAX_LOG_WAIT_MS)]),
          delay(MIN_REDIRECT_DELAY_MS)
        ])
          .catch(function () { /* noop */ })
          .finally(function () {
            window.location.replace(TARGET_URL);
          });
      })();
    </script>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 2rem; display: flex; min-height: 100vh; align-items: center; justify-content: center; background: #0f172a; color: #e2e8f0; }
      .card { background: #111827; padding: 1.5rem 2rem; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,.35); max-width: 720px; text-align: center; }
      a { color: #93c5fd; }
      .small { opacity: .75; font-size: .9rem; }
    </style>
  </head>
  <body>
    <div class="card">
      <h1>Reindirizzamento in corso…</h1>
      <p class="small">Se non vieni reindirizzato automaticamente, <a href="https://www.rainews.it/tgr/piemonte/video/2023/03/tgr-piemonte-web-moricone-satelliti-militari-pl-sicral-centro-interforze-ucraina-1cc6d906-e8ff-4459-b243-82501d24c32f.html">clicca qui</a>.</p>
    </div>
  </body>
  </html>
